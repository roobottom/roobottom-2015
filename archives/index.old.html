
{% for post in site.posts  %}
    {% capture this_year %}{{ post.date | date: "%Y" }}{% endcapture %}
    {% capture this_month %}{{ post.date | date: "%B" }}{% endcapture %}
    {% capture next_year %}{{ post.previous.date | date: "%Y" }}{% endcapture %}
    {% capture next_month %}{{ post.previous.date | date: "%B" }}{% endcapture %}

    {% if forloop.first %}
    <h1 id="{{ this_year }}-ref" class="u-centre repel--1">{{this_year}}</h1>
    <h2 id="{{ this_year }}-{{ this_month }}-ref" class="u-centre repel--1">{{ this_month }} {{ this_year }}</h2>
    <div class="gallery pull--extended">
    <ol class="gallery-row">
    {% endif %}

    <li class="gallery-item">
        <a href="{{ site.baseurl }}{{ post.url }}" title="{{ post.title }}">
            
            {% case post.categories[0] %}
                {% when 'diary' %}
                    {% assign currentImage = post.images[0].image %}
                {% when 'gallery' %}
                    {% assign currentImage = post.images[0].image %}
                {% when 'notes' %}
                    {% assign currentImage = post.images[0] %}
                {% else %}
                    
            {% endcase %}
            
            {% if currentImage %}
                <img src="{{ site.roobottom_assets }}/{{ post.categories[0]}}/medium/{{ currentImage }}" class="gallery-image"/>
            {% else %}
                <img src="{{ site.baseurl }}/css/images/calendar-default.png"/>
            {% endif %}
            
            <time>{{ post.date | date date: "%a %d" }}</time>
            
            <p class="calendar-title">{{ post.title }}</p>
        </a> 
    </li>

    {% if forloop.last %}
    </ol>
    </div>
    {% else %}
        {% if this_year != next_year %}
        </ol>
        </div>
        <hr/>
        <h1 id="{{ next_year }}-ref" class="u-centre repel--1">{{next_year}}</h1>
        <h2 id="{{ next_year }}-{{ next_month }}-ref" class="u-centre repel--1">{{ next_month }} {{ next_year }}</h2>
        <div class="gallery pull--extended">
        <ol class="gallery-row">
        {% else %}    
            {% if this_month != next_month %}
            </ol>
            </div>
            <h2 id="{{ this_year }}-{{ next_month }}-ref" class="u-centre repel--1">{{ next_month }} {{ this_year }}</h2>
            <div class="gallery pull--extended">
            <ol class="gallery-row">
            {% endif %}
        {% endif %}
    {% endif %}
{% endfor %}